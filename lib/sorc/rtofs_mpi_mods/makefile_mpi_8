SHELL=/bin/sh

# These modules are used by several of the OFS source codes. They are 
# extracted to build a library, so that there won't be multiple copies 
# of the same files. 
 
LIB=../../librtofs_mpi_mods_8.a

#--------------------------------------
# The following was used for XLF on AIX
DEFS= -DAIX -DREAL4
FC=ncepxlf95
CPP=/usr/lib/cpp -P
CPPFLAGS  =DAIX -DREAL8 -DMPI -DSERIAL_IO -DTIMER -DARCTIC
FFLAGS= -qfixed -qstrict -qspillsize=32000 -qwarn64 -qrealsize=8 -qintsize=4 \
        -qflttrap=overflow:zerodivide:invalid:enable:imprecise -qsigtrap
CFLAGS= 
ARFLAGS= -X64 -q -v
LDFLAGS= $(FFLAGS) -b64


RM            = \rm -f
#
# rules.
#
.SUFFIXES: .c .a .f .F 

.c.o:
	$(CC) $(CPPFLAGS) $(CCFLAGS)  -c $*.c

.f.o:
	$(FC)  $(FCFFLAGS) -c $*.f

.F.o:
	$(RM) $<.f
	$(CPP) $(CPPFLAGS) $< | sed -e '/^ *$$/d' > $<.f
	$(FC) $(FFLAGS) -c $<.f

.f.a:	$(FC) -c $(FFLAGS) $<
	ar $(ARFLAGS) $@ $*.o

$(LIB):	$(LIB)( mod_dimensions.o mod_xc.o mod_za.o wtime.o )

mod_dimensions.o:   mod_dimensions.F dimensions.h
mod_xc.o: mod_xc.F  mod_dimensions.o mod_xc_sm.h mod_xc_mp.h unit_offset.h
mod_za.o: mod_za.F  mod_xc.o         mod_za_sm.h mod_za_mp.h mod_za_mp1.h
wtime.o:   wtime.F
